import streamlit as st
from typing import Dict, List
from dataclasses import dataclass

st.set_page_config(page_title="MBTI 직업 추천 (중학생용)", page_icon="🎒", layout="centered")

# -------------------------------
# 데이터 모델
# -------------------------------
@dataclass
class Career:
    name: str
    why: str
    subjects: List[str]
    skills: List[str]

# MBTI -> 3개 직업 매핑 (중학생 눈높이에 맞춰 순화)
CAREER_MAP: Dict[str, List[Career]] = {
    "ISTJ": [
        Career("토목/건축 엔지니어 🏗️", "체계와 규칙을 잘 지켜 큰 프로젝트를 차근차근 완성함", ["수학", "과학", "기술·가정"], ["계획 세우기", "세부 점검", "안전 의식"]),
        Career("회계/재무 전문가 📊", "숫자와 기록을 정확히 다루는 강점", ["수학", "사회(경제)"], ["정확성", "책임감", "윤리성"]),
        Career("물류/운영 매니저 🚚", "물건의 이동과 일정 관리에 강함", ["사회", "수학"], ["조직력", "문제 해결", "의사소통"]),
    ],
    "ISFJ": [
        Career("간호사/보건 전문가 🩺", "따뜻함과 책임감으로 사람을 세심하게 돌봄", ["과학(생명)", "보건"], ["공감", "성실", "협업"]),
        Career("초등/돌봄 교사 🍎", "학생을 안정적으로 지도하며 배움을 돕는 데 강점", ["국어", "사회", "예체능"], ["인내", "관찰", "의사소통"]),
        Career("사서/정보 큐레이터 📚", "자료를 정리하고 필요한 정보를 찾아 연결", ["국어", "사회"], ["정리정돈", "검색 능력", "친절"]),
    ],
    "INFJ": [
        Career("심리/상담 전문가 🧠", "사람의 마음을 깊이 이해하고 돕고자 함", ["사회", "국어"], ["경청", "분석", "윤리적 판단"]),
        Career("사회복지사 🤝", "사회적 약자를 지원하고 변화를 만드는 일에 관심", ["사회", "도덕"], ["책임감", "공감", "기획"]),
        Career("작가/콘텐츠 기획자 ✍️", "아이디어를 구조화해 메시지를 설계", ["국어", "사회"], ["창의성", "기획", "집중력"]),
    ],
    "INTJ": [
        Career("데이터 사이언티스트 📈", "논리적으로 계획하고 장기 전략을 세움", ["수학", "과학", "정보/컴퓨터"], ["모델링", "분석", "문제 해결"]),
        Career("연구개발 엔지니어 🔬", "지식을 응용해 새로운 것을 설계", ["수학", "과학"], ["가설 설정", "실험 설계", "정밀함"]),
        Career("도시/전략 기획자 🧭", "복잡한 시스템을 설계하고 최적화", ["사회(지리/정치)"], ["시스템 사고", "계획", "조정력"]),
    ],
    "ISTP": [
        Career("항공정비/메카닉 ✈️", "손으로 문제를 해결하고 원리를 빠르게 파악", ["과학", "기술·가정"], ["도구 다루기", "원인 분석", "침착함"]),
        Career("디지털 포렌식/보안 🔐", "기술적 단서를 찾아 논리로 추적", ["정보/컴퓨터", "수학"], ["분석", "세부 관찰", "집중"]),
        Career("드론/로봇 운영자 🤖", "새로운 기기를 직접 다루며 효율을 중시", ["과학", "정보/컴퓨터"], ["조작", "튜닝", "문제 해결"]),
    ],
    "ISFP": [
        Career("그래픽/브랜딩 디자이너 🎨", "감각적으로 아름다움을 표현", ["미술", "국어"], ["색채 감각", "협업", "관찰"]),
        Career("플로리스트/공간 스타일리스트 🌷", "감성적인 분위기 연출", ["미술", "기술·가정"], ["디테일", "손기술", "서비스 마인드"]),
        Career("셰프/디저트 크리에이터 🍰", "미각과 창의로 즐거움을 만듦", ["기술·가정", "수학(계량)"], ["위생", "창의성", "인내"]),
    ],
    "INFP": [
        Career("작가/시나리오 작가 📖", "가치와 스토리를 섬세하게 담아냄", ["국어", "사회"], ["상상력", "집중", "메시지 설계"]),
        Career("청소년 지도사/교육 콘텐츠 제작자 🎒", "학생의 성장을 돕는 일에 보람", ["사회", "국어"], ["공감", "기획", "소통"]),
        Career("NGO/국제개발 활동가 🌏", "더 나은 세상을 위한 프로젝트에 관심", ["사회", "외국어"], ["가치지향", "협업", "문제 해결"]),
    ],
    "INTP": [
        Career("소프트웨어 개발자 👩‍💻", "아이디어를 알고리즘과 코드로 구현", ["정보/컴퓨터", "수학"], ["추상화", "디버깅", "논리"]),
        Career("연구원/과학자 🔭", "호기심으로 원리를 깊게 파고듦", ["수학", "과학"], ["분석", "가설 검증", "비판적 사고"]),
        Career("데이터 분석가 📊", "데이터에서 패턴을 찾아 설명", ["수학", "정보/컴퓨터"], ["통계적 사고", "시각화", "해석"]),
    ],
    "ESTP": [
        Career("기업가/세일즈 리더 🚀", "현장에서 빠르게 판단하고 실행", ["사회", "수학"], ["설득", "네트워킹", "결단"]),
        Career("스포츠 코치/트레이너 🏃", "에너지와 실전 감각으로 지도", ["체육", "과학(생리)"], ["동기부여", "피드백", "리더십"]),
        Career("응급구조/현장 대응 요원 🚑", "위기 상황에서 침착하게 행동", ["과학", "보건"], ["침착", "체력", "협업"]),
    ],
    "ESFP": [
        Career("행사/이벤트 플래너 🎉", "분위기를 살리고 사람을 즐겁게 함", ["국어", "사회"], ["기획", "커뮤니케이션", "센스"]),
        Career("공연/엔터테이너 🎭", "무대에서 재능을 표현", ["음악/미술", "국어"], ["창의성", "표현력", "팀워크"]),
        Career("승무원/서비스 전문가 ✈️", "친절과 배려로 경험을 디자인", ["외국어", "사회"], ["서비스 마인드", "상황 대처", "공감"]),
    ],
    "ENFP": [
        Career("마케팅/콘텐츠 크리에이터 📣", "아이디어로 사람의 관심을 모음", ["국어", "사회"], ["스토리텔링", "기획", "협업"]),
        Career("교사/에듀테크 기획자 🧑‍🏫", "학습을 재미있게 설계", ["국어", "정보/컴퓨터"], ["소통", "창의성", "공감"]),
        Career("사회혁신가/스타트업 메이커 🧩", "새로운 해결책으로 변화를 시도", ["사회", "수학"], ["문제 발견", "네트워킹", "실행"]),
    ],
    "ENTP": [
        Career("제품/서비스 기획자 🧪", "다양한 아이디어를 실험하고 개선", ["수학", "사회"], ["가설 검증", "설득", "분석"]),
        Career("창업가/벤처 빌더 🛠️", "새로운 모델을 만들고 피봇", ["수학", "사회"], ["실험정신", "전략", "네트워킹"]),
        Career("미디어/정책 분석가 📰", "토론과 논리로 관점을 제시", ["사회", "국어"], ["비판적 사고", "설득", "글쓰기"]),
    ],
    "ESTJ": [
        Career("프로젝트 매니저 📅", "사람과 자원을 조직적으로 조정", ["사회", "수학"], ["리더십", "계획", "의사결정"]),
        Career("경찰/공공 행정 👮", "규칙과 질서를 유지하며 봉사", ["사회", "도덕"], ["정의감", "책임감", "소통"]),
        Career("운영/공장 관리자 🏭", "현장을 효율적으로 관리", ["수학", "과학"], ["절차 설계", "점검", "리스크 관리"]),
    ],
    "ESFJ": [
        Career("HR/교육 코디네이터 🧩", "사람을 연결하고 팀 분위기를 이끔", ["사회", "국어"], ["조정", "배려", "소통"]),
        Career("간호/보건 코디네이터 🏥", "현장에서 환자와 팀을 동시에 배려", ["과학", "보건"], ["공감", "협업", "조직력"]),
        Career("호텔/관광 매니저 🏨", "서비스 품질을 관리하고 경험을 설계", ["외국어", "사회"], ["서비스", "기획", "세심함"]),
    ],
    "ENFJ": [
        Career("교사/교육 리더 🍎", "학생의 가능성을 발견하고 성장 지원", ["국어", "사회"], ["코칭", "공감", "소통"]),
        Career("커뮤니티/비영리 기획자 🫶", "사람을 모아 긍정적 변화를 만듦", ["사회", "국어"], ["조직", "홍보", "기획"]),
        Career("홍보/커뮤니케이션 전문가 📢", "메시지를 설계해 사회와 소통", ["국어", "사회"], ["스토리텔링", "협업", "분석"]),
    ],
    "ENTJ": [
        Career("경영/전략 컨설턴트 🧠", "큰 그림을 그려 목표를 이끎", ["수학", "사회"], ["전략", "의사결정", "분석"]),
        Career("변호사/정책 리더 ⚖️", "복잡한 문제를 구조화해 해결", ["사회", "국어"], ["논리", "설득", "끈기"]),
        Career("프로덕트 오너/디렉터 🎯", "목표를 명확히 하고 팀을 이끔", ["수학", "정보/컴퓨터"], ["우선순위", "리더십", "실행"]),
    ],
}

MBTI_TYPES = list(CAREER_MAP.keys())

# -------------------------------
# 헬퍼
# -------------------------------

def render_career(c: Career):
    st.markdown(
        f"""
        **{c.name}**  
        • 추천 이유: {c.why}  
        • 어울리는 과목: {', '.join(c.subjects)}  
        • 키워드: {', '.join(c.skills)}
        """
    )


def mission_suggestions(mbti: str) -> List[str]:
    base = {
        "maker": "메이커 프로젝트 만들기(예: 간단한 로봇/앱/웹) 🔧",
        "shadowing": "직업 인터뷰/직무 체험 기록하기(학교/지역 사회) 📝",
        "portfolio": "작품·보고서 포트폴리오 정리하기(사진+설명) 📁",
        "read": "관심 진로 책/기사 1편 읽고 핵심 3줄 요약하기 📚",
        "present": "친구에게 3분 소개자료 만들기(발표 대신 포스터) 🎨",
    }
    # 유형별 강조 포인트 살짝 커스터마이즈
    if mbti in ("INTP", "INTJ", "ISTJ"):
        return [base["maker"], base["read"], base["portfolio"]]
    if mbti in ("ENFP", "ENFJ", "ESFP"):
        return [base["shadowing"], base["present"], base["portfolio"]]
    if mbti in ("ISTP", "ESTP"):
        return [base["maker"], base["shadowing"], base["portfolio"]]
    if mbti in ("ISFJ", "ESFJ"):
        return [base["shadowing"], base["read"], base["portfolio"]]
    if mbti in ("INFP", "INFJ"):
        return [base["read"], base["present"], base["portfolio"]]
    if mbti in ("ESTJ", "ENTJ", "ENTP"):
        return [base["maker"], base["present"], base["portfolio"]]
    if mbti in ("ISFP", ):
        return [base["present"], base["portfolio"], base["read"]]
    return [base["portfolio"], base["read"], base["shadowing"]]


# -------------------------------
# UI
# -------------------------------
with st.sidebar:
    st.markdown("""
    ### 🎒 MBTI 직업 추천
    MBTI를 고르면, 중학생 눈높이에 맞춘 **직업 3가지**와 
    **어울리는 과목/능력, 실천 미션**을 보여줘요!
    
    - 추가 설치 ❌ (Streamlit만 사용)
    - 담임/진로 수업에서 바로 활용 ✅
    - 이모지로 직관적인 이해 도와줘요 ✨
    """)
    st.divider()
    st.caption("*MBTI는 성격 경향을 이해하는 보조 도구이며, 진로를 제한하지 않아요!*")

st.title("🧭 MBTI 기반 직업 추천 (중학생용)")
st.write("원하는 MBTI 유형을 선택하면 맞춤 추천을 보여줘요. 자신과 가까운 유형 여러 개를 눌러 비교해도 좋아요!")

# 선택
col1, col2 = st.columns(2)
with col1:
    mbti = st.selectbox("MBTI를 선택하세요", MBTI_TYPES, index=MBTI_TYPES.index("ENFP") if "ENFP" in MBTI_TYPES else 0)
with col2:
    show_details = st.toggle("과목/키워드 자세히 보기", value=True)

# 결과 출력
if mbti:
    st.subheader(f"🔎 {mbti} 유형 추천 직업 3가지")
    careers = CAREER_MAP.get(mbti, [])
    if not careers:
        st.info("해당 유형의 데이터가 아직 없어요. 다른 유형을 선택해 주세요.")
    else:
        for i, c in enumerate(careers, start=1):
            with st.container(border=True):
                st.markdown(f"**{i}. {c.name}**")
                st.markdown(f"추천 이유: {c.why}")
                if show_details:
                    st.markdown(f"어울리는 과목: **{', '.join(c.subjects)}**")
                    st.markdown(f"키워드: **{', '.join(c.skills)}**")

        st.markdown("\n")
        with st.container(border=True):
            st.markdown("### 🧪 오늘의 진로 미션 3가지")
            for m in mission_suggestions(mbti):
                st.markdown(f"- {m}")

# 비교 보기
st.markdown("\n")
with st.expander("👀 다른 유형과 빠른 비교표"):
    st.markdown("MBTI 16유형의 대표 키워드를 한눈에 볼 수 있어요.")
    header = "|유형|핵심 키워드|\n|---|---|\n"
    rows = []
    keyword_presets = {
        "ISTJ": "계획·정확성·책임",
        "ISFJ": "배려·성실·안정",
        "INFJ": "통찰·가치·도움",
        "INTJ": "전략·분석·목표",
        "ISTP": "실전·분석·침착",
        "ISFP": "감성·미감·자유",
        "INFP": "가치·창의·배려",
        "INTP": "논리·탐구·호기심",
        "ESTP": "실행·도전·에너지",
        "ESFP": "사교·표현·재미",
        "ENFP": "아이디어·소통·열정",
        "ENTP": "토론·실험·유연",
        "ESTJ": "조직·규칙·효율",
        "ESFJ": "협력·배려·관리",
        "ENFJ": "리더십·코칭·공감",
        "ENTJ": "리딩·전략·결단",
    }
    for t in MBTI_TYPES:
        rows.append(f"|{t}|{keyword_presets.get(t, '-') }|")
    st.markdown(header + "\n".join(rows))

# 하단 안내
st.divider()
st.caption("ⓘ 본 서비스는 학교 진로/진학 상담 보조용입니다. 개인의 흥미·경험·가치에 따라 다양한 진로가 가능합니다. 💙")
